<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desaf√≠o de Qu√≠mica üß™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            padding: 20px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            opacity: 0.9;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            display: inline-block;
            min-width: 120px;
            text-align: center;
        }

        .lives {
            background: linear-gradient(45deg, #ff6b6b, #ee5a5a);
        }

        .level {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .challenge-panel {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .challenge-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .target-element {
            font-size: 4em;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .challenge-description {
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .challenge-hint {
            font-size: 1em;
            opacity: 0.9;
            font-style: italic;
        }

        .lab-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 30px;
            min-height: 600px;
            align-items: flex-start;
            justify-content: center;
        }

        .elements-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 3px dashed #ddd;
            flex: 1 1 250px;
            min-width: 250px;
        }

        .mixing-area {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            border-radius: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 4px solid #3498db;
            box-shadow: inset 0 0 30px rgba(52, 152, 219, 0.3);
            flex: 0 1 400px;
            max-width: 100%;
        }

        .elements-panel h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-size: clamp(1.1rem, 3vw, 1.3rem);
        }

        .elements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 8px;
        }

        .element {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            place-self: center;
        }

        .element:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .element.dragging {
            cursor: grabbing;
            transform: rotate(10deg) scale(1.1);
            z-index: 1000;
        }

        .element.used {
            opacity: 0.5;
            pointer-events: none;
        }

        .element-icon {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 5px;
        }

        .element-name {
            font-size: clamp(0.6rem, 2vw, 0.8rem);
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Colores de elementos */
        .water { background: linear-gradient(45deg, #3498db, #2980b9); }
        .fire { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .earth { background: linear-gradient(45deg, #8b4513, #654321); }
        .air { background: linear-gradient(45deg, #ecf0f1, #bdc3c7); }
        .ice { background: linear-gradient(45deg, #85c1e9, #5dade2); }
        .light { background: linear-gradient(45deg, #f1c40f, #f39c12); }
        .oxygen { background: linear-gradient(45deg, #74b9ff, #0984e3); }
        .carbon { background: linear-gradient(45deg, #2d3436, #636e72); }
        .metal { background: linear-gradient(45deg, #95a5a6, #7f8c8d); }
        .salt { background: linear-gradient(45deg, #ffffff, #ecf0f1); }
        .acid { background: linear-gradient(45deg, #00b894, #00a085); }
        .oil { background: linear-gradient(45deg, #6c5ce7, #5f3dc4); }
        .seed { background: linear-gradient(45deg, #00b894, #00a085); }
        .electricity { background: linear-gradient(45deg, #fdcb6e, #e17055); }
        .pressure { background: linear-gradient(45deg, #fd79a8, #e84393); }
        .cold { background: linear-gradient(45deg, #74b9ff, #0984e3); }

        .beaker {
            width: 200px;
            height: 250px;
            background: linear-gradient(to bottom, 
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0.05) 50%,
                rgba(255,255,255,0.1) 100%);
            border: 4px solid #ecf0f1;
            border-radius: 0 0 50px 50px;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 20px;
        }

        .beaker::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 20px;
            right: 20px;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px 10px 0 0;
        }

        .mixture-display {
            width: 100%;
            height: 100px;
            border-radius: 0 0 46px 46px;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
            overflow: hidden;
        }

        .mixture-display.bubbling::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255,255,255,0.3) 0%, 
                transparent 50%);
            animation: bubble 2s infinite;
        }

        @keyframes bubble {
            0% { transform: translateY(100%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }

        .drop-zone {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            border: 3px dashed rgba(255,255,255,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.7);
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
            padding: 10px;
        }

        .drop-zone.drag-over {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.2);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .controls {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .clear-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .hint-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .next-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .message-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .message-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .message-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 15px;
        }

        .message-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 25px;
        }

        .message-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            font-weight: bold;
        }

        /* Media Queries */
        @media (max-width: 992px) {
            .lab-area {
                flex-direction: column;
                align-items: center;
            }

            .elements-panel, .mixing-area {
                flex: 1 1 100%;
                max-width: 100%;
            }

            .mixing-area {
                order: 2;
            }

            .elements-panel {
                order: 1;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
            }
            
            .lab-area {
                padding: 20px 10px;
                gap: 15px;
            }
            
            .elements-panel {
                padding: 15px;
            }
            
            .elements-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }
            
            .element {
                width: 60px;
                height: 60px;
            }
            
            .game-stats {
                gap: 10px;
            }
            
            .stat-box {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 1em;
            }
            
            .challenge-panel {
                margin: 15px;
                padding: 15px;
            }
            
            .target-element {
                font-size: 3em;
            }
        }

        @media (max-width: 480px) {
            .game-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .stat-box {
                width: 200px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Desaf√≠o de Qu√≠mica</h1>
            <p>¬°Crea el elemento objetivo combinando los ingredientes correctos!</p>
        </div>

        <div class="game-stats">
            <div class="stat-box">üèÜ Puntos: <span id="score">0</span></div>
            <div class="stat-box lives">‚ù§Ô∏è Vidas: <span id="lives">3</span></div>
            <div class="stat-box level">üéØ Nivel: <span id="level">1</span></div>
        </div>

        <div class="challenge-panel" id="challengePanel">
            <div class="challenge-title">üéØ OBJETIVO</div>
            <div class="target-element" id="targetElement">üåà</div>
            <div class="challenge-description" id="challengeDescription">Crea un Arco√≠ris</div>
            <div class="challenge-hint" id="challengeHint">Combina elementos que interact√∫en con la luz y el agua</div>
        </div>

        <div class="lab-area">
            <div class="elements-panel">
                <h3>üåü Elementos Disponibles</h3>
                <div class="elements-grid" id="elementsGrid">
                    <div class="element water" draggable="true" data-element="water">
                        <div class="element-icon">üíß</div>
                        <div class="element-name">Agua</div>
                    </div>
                    <div class="element fire" draggable="true" data-element="fire">
                        <div class="element-icon">üî•</div>
                        <div class="element-name">Fuego</div>
                    </div>
                    <div class="element earth" draggable="true" data-element="earth">
                        <div class="element-icon">üåç</div>
                        <div class="element-name">Tierra</div>
                    </div>
                    <div class="element air" draggable="true" data-element="air">
                        <div class="element-icon">üí®</div>
                        <div class="element-name">Aire</div>
                    </div>
                    <div class="element ice" draggable="true" data-element="ice">
                        <div class="element-icon">üßä</div>
                        <div class="element-name">Hielo</div>
                    </div>
                    <div class="element light" draggable="true" data-element="light">
                        <div class="element-icon">‚òÄÔ∏è</div>
                        <div class="element-name">Luz</div>
                    </div>
                    <div class="element oxygen" draggable="true" data-element="oxygen">
                        <div class="element-icon">ü´Å</div>
                        <div class="element-name">Ox√≠geno</div>
                    </div>
                    <div class="element carbon" draggable="true" data-element="carbon">
                        <div class="element-icon">‚ö´</div>
                        <div class="element-name">Carb√≥n</div>
                    </div>
                    <div class="element metal" draggable="true" data-element="metal">
                        <div class="element-icon">üî©</div>
                        <div class="element-name">Metal</div>
                    </div>
                    <div class="element salt" draggable="true" data-element="salt">
                        <div class="element-icon">üßÇ</div>
                        <div class="element-name">Sal</div>
                    </div>
                    <div class="element acid" draggable="true" data-element="acid">
                        <div class="element-icon">üß™</div>
                        <div class="element-name">√Åcido</div>
                    </div>
                    <div class="element oil" draggable="true" data-element="oil">
                        <div class="element-icon">üõ¢Ô∏è</div>
                        <div class="element-name">Aceite</div>
                    </div>
                    <div class="element seed" draggable="true" data-element="seed">
                        <div class="element-icon">üå±</div>
                        <div class="element-name">Semilla</div>
                    </div>
                    <div class="element electricity" draggable="true" data-element="electricity">
                        <div class="element-icon">‚ö°</div>
                        <div class="element-name">Electric.</div>
                    </div>
                    <div class="element pressure" draggable="true" data-element="pressure">
                        <div class="element-icon">üí™</div>
                        <div class="element-name">Presi√≥n</div>
                    </div>
                    <div class="element cold" draggable="true" data-element="cold">
                        <div class="element-icon">ü•∂</div>
                        <div class="element-name">Fr√≠o</div>
                    </div>
                </div>
            </div>

            <div class="mixing-area">
                <div class="beaker">
                    <div class="mixture-display" id="mixture-display"></div>
                    <div class="drop-zone" id="drop-zone">
                        Arrastra elementos aqu√≠
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn clear-btn" onclick="clearLab()">üóëÔ∏è Limpiar</button>
            <button class="btn hint-btn" onclick="showHint()">üí° Pista</button>
            <button class="btn next-btn" onclick="nextChallenge()" id="nextBtn" style="display: none;">‚û°Ô∏è Siguiente</button>
        </div>
    </div>

    <div class="message-overlay" id="messageOverlay">
        <div class="message-content">
            <div class="message-icon" id="messageIcon">üéâ</div>
            <h2 class="message-title" id="messageTitle">¬°Correcto!</h2>
            <p class="message-text" id="messageText">Has creado el elemento objetivo correctamente.</p>
            <button class="message-btn" onclick="closeMessage()">Continuar</button>
        </div>
    </div>

    <script>
        let currentMixture = [];
        let score = 0;
        let lives = 3;
        let level = 1;
        let currentChallenge = 0;

        const challenges = [
            {
                target: 'light+water',
                icon: 'üåà',
                name: 'Arco√≠ris',
                hint: 'La luz se descompone al pasar por el agua',
                description: 'Crea un Arco√≠ris'
            },
            {
                target: 'water+earth',
                icon: 'üü§',
                name: 'Barro',
                hint: 'El agua mezclada con tierra forma...',
                description: 'Crea Barro'
            },
            {
                target: 'fire+ice',
                icon: 'üí®',
                name: 'Vapor',
                hint: 'El calor derrite el hielo y lo convierte en...',
                description: 'Crea Vapor'
            },
            {
                target: 'carbon+pressure',
                icon: 'üíé',
                name: 'Diamante',
                hint: 'El carb√≥n bajo mucha presi√≥n se convierte en...',
                description: 'Crea un Diamante'
            },
            {
                target: 'electricity+metal',
                icon: '‚ö°',
                name: 'Conductor',
                hint: 'Los metales permiten que pase la electricidad',
                description: 'Crea un Conductor'
            },
            {
                target: 'seed+water',
                icon: 'üå±',
                name: 'Germinaci√≥n',
                hint: 'Las semillas necesitan agua para crecer',
                description: 'Logra la Germinaci√≥n'
            },
            {
                target: 'fire+oxygen',
                icon: 'üî•',
                name: 'Combusti√≥n',
                hint: 'El ox√≠geno alimenta el fuego',
                description: 'Crea Combusti√≥n'
            },
            {
                target: 'cold+water',
                icon: 'üßä',
                name: 'Hielo',
                hint: 'El fr√≠o congela el agua',
                description: 'Crea Hielo'
            }
        ];

        const reactions = {
            'light+water': { result: 'üåà Arco√≠ris', explanation: 'La luz se descompone en el agua formando un arco√≠ris por refracci√≥n.', color: '#FF69B4', icon: 'üåà' },
            'water+earth': { result: 'üü§ Barro', explanation: 'El agua y la tierra se combinan para formar barro.', color: '#8B4513', icon: 'üü§' },
            'fire+ice': { result: 'üí® Vapor', explanation: 'El fuego derrite el hielo y lo convierte en vapor de agua.', color: '#E0E0E0', icon: 'üí®' },
            'fire+water': { result: 'üí® Vapor', explanation: 'El calor del fuego evapora el agua.', color: '#E0E0E0', icon: 'üí®' },
            'air+water': { result: '‚òÅÔ∏è Nube', explanation: 'El vapor de agua en el aire forma nubes.', color: '#87CEEB', icon: '‚òÅÔ∏è' },
            'earth+fire': { result: 'üåã Lava', explanation: 'El fuego intenso derrite la tierra, creando lava volc√°nica.', color: '#FF4500', icon: 'üåã' },
            'air+fire': { result: 'üí• Explosi√≥n', explanation: 'El aire alimenta el fuego, creando una combusti√≥n m√°s intensa.', color: '#FFD700', icon: 'üí•' },
            'ice+water': { result: 'üåä Agua Fr√≠a', explanation: 'El hielo se derrite en el agua, pero la mantiene fr√≠a.', color: '#4682B4', icon: 'üåä' },
            'air+earth': { result: 'üå™Ô∏è Torbellino', explanation: 'El aire fuerte levanta part√≠culas de tierra formando remolinos.', color: '#DEB887', icon: 'üå™Ô∏è' },
            'ice+light': { result: 'üíé Cristal', explanation: 'La luz refracta a trav√©s del hielo creando efectos cristalinos.', color: '#E6E6FA', icon: 'üíé' },
            'fire+light': { result: 'üí° Energ√≠a', explanation: 'El fuego y la luz se combinan para generar m√°s energ√≠a luminosa.', color: '#FFD700', icon: 'üí°' },
            'fire+oxygen': { result: 'üî• Combusti√≥n', explanation: 'El ox√≠geno alimenta el fuego creando una combusti√≥n m√°s intensa.', color: '#FF6347', icon: 'üî•' },
            'carbon+fire': { result: 'üí® CO2', explanation: 'El carb√≥n se quema con el fuego produciendo di√≥xido de carbono.', color: '#696969', icon: 'üí®' },
            'carbon+oxygen': { result: 'üí® CO2', explanation: 'El carbono se oxida formando di√≥xido de carbono.', color: '#696969', icon: 'üí®' },
            'metal+fire': { result: 'üî• Metal Caliente', explanation: 'El metal se calienta con el fuego pero no se quema f√°cilmente.', color: '#FF4500', icon: 'üî•' },
            'metal+oxygen': { result: 'üü§ √ìxido', explanation: 'El metal se oxida al contacto con el ox√≠geno formando herrumbre.', color: '#CD853F', icon: 'üü§' },
            'salt+water': { result: 'üåä Agua Salada', explanation: 'La sal se disuelve en el agua formando una soluci√≥n salina.', color: '#4682B4', icon: 'üåä' },
            'acid+metal': { result: 'üí® Corrosi√≥n', explanation: 'El √°cido corroe el metal liberando gases en una reacci√≥n qu√≠mica.', color: '#228B22', icon: 'üí®' },
            'oil+fire': { result: 'üî• Llama Intensa', explanation: 'El aceite es combustible y arde con una llama muy intensa.', color: '#FF8C00', icon: 'üî•' },
            'oil+water': { result: 'üõ¢Ô∏è No se mezcla', explanation: 'El aceite y el agua no se mezclan debido a sus densidades diferentes.', color: '#4B0082', icon: 'üõ¢Ô∏è' },
            'earth+seed': { result: 'üå± Brote', explanation: 'Las semillas germinan en la tierra con los nutrientes necesarios.', color: '#32CD32', icon: 'üå±' },
            'light+seed': { result: 'üå± Fotos√≠ntesis', explanation: 'Las plantas necesitan luz para realizar la fotos√≠ntesis y crecer.', color: '#228B22', icon: 'üå±' },
            'seed+water': { result: 'üå± Germinaci√≥n', explanation: 'Las semillas necesitan agua para germinar y comenzar a crecer.', color: '#32CD32', icon: 'üå±' },
            'electricity+metal': { result: '‚ö° Conductor', explanation: 'Los metales conducen la electricidad muy bien.', color: '#FFD700', icon: '‚ö°' },
            'electricity+water': { result: '‚ö° Electr√≥lisis', explanation: 'La electricidad puede descomponer el agua en ox√≠geno e hidr√≥geno.', color: '#00BFFF', icon: '‚ö°' },
            'electricity+fire': { result: 'üí• Chispa', explanation: 'La electricidad puede generar chispas que encienden fuego.', color: '#FF1493', icon: 'üí•' },
            'carbon+pressure': { result: 'üíé Diamante', explanation: 'El carbono bajo extrema presi√≥n se convierte en diamante.', color: '#E0E0E0', icon: 'üíé' },
            'earth+pressure': { result: 'üóø Roca', explanation: 'La tierra comprimida bajo presi√≥n forma rocas s√≥lidas.', color: '#696969', icon: 'üóø' },
            'pressure+water': { result: 'üíß Agua a presi√≥n', explanation: 'El agua bajo presi√≥n puede cortear y tener m√°s fuerza.', color: '#1E90FF', icon: 'üíß' },
            'cold+water': { result: 'üßä Hielo', explanation: 'El fr√≠o congela el agua convirti√©ndola en hielo s√≥lido.', color: '#87CEEB', icon: 'üßä' },
            'cold+fire': { result: 'üí® Se apaga', explanation: 'El fr√≠o extremo puede apagar el fuego reduciendo la temperatura.', color: '#778899', icon: 'üí®' },
            'air+cold': { result: '‚ùÑÔ∏è Viento Fr√≠o', explanation: 'El aire fr√≠o forma corrientes de viento helado.', color: '#B0C4DE', icon: '‚ùÑÔ∏è' }
        };

        function initializeGame() {
            loadChallenge();
            updateStats();
            setupDragAndDrop();
        }

        function loadChallenge() {
            const challenge = challenges[currentChallenge];
            document.getElementById('targetElement').textContent = challenge.icon;
            document.getElementById('challengeDescription').textContent = challenge.description;
            document.getElementById('challengeHint').textContent = challenge.hint;
            
            // Reset elements
            document.querySelectorAll('.element').forEach(el => {
                el.classList.remove('used');
            });
        }

        function setupDragAndDrop() {
            document.querySelectorAll('.element').forEach(element => {
                element.addEventListener('dragstart', handleDragStart);
                element.addEventListener('dragend', handleDragEnd);
            });

            const dropZone = document.getElementById('drop-zone');
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragenter', handleDragEnter);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
        }

        function handleDragStart(e) {
            if (e.target.classList.contains('used')) {
                e.preventDefault();
                return;
            }
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.element);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            document.getElementById('drop-zone').classList.add('drag-over');
        }

        function handleDragLeave(e) {
            document.getElementById('drop-zone').classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('drop-zone').classList.remove('drag-over');
            
            const element = e.dataTransfer.getData('text/plain');
            addElementToMixture(element);
        }

        function addElementToMixture(element) {
            if (currentMixture.length < 2) {
                currentMixture.push(element);
                
                // Marcar elemento como usado
                const elementDiv = document.querySelector(`[data-element="${element}"]`);
                elementDiv.classList.add('used');
                
                updateMixtureDisplay();
                
                if (currentMixture.length === 2) {
                    setTimeout(() => {
                        processReaction();
                    }, 1000);
                }
            }
        }

        function updateMixtureDisplay() {
            const display = document.getElementById('mixture-display');
            const dropZone = document.getElementById('drop-zone');
            
            if (currentMixture.length === 0) {
                display.innerHTML = '';
                display.style.background = 'transparent';
                dropZone.style.display = 'flex';
                dropZone.textContent = 'Arrastra elementos aqu√≠';
            } else if (currentMixture.length === 1) {
                const elementIcon = getElementIcon(currentMixture[0]);
                display.innerHTML = elementIcon;
                display.style.background = getElementColor(currentMixture[0]);
                dropZone.style.display = 'flex';
                dropZone.textContent = 'Agrega otro elemento';
            } else {
                dropZone.style.display = 'none';
                display.classList.add('bubbling');
            }
        }

        function processReaction() {
            const mixture = currentMixture.sort().join('+');
            const reaction = reactions[mixture];
            const display = document.getElementById('mixture-display');
            const currentChallengeData = challenges[currentChallenge];
            
            if (reaction) {
                display.innerHTML = reaction.icon;
                display.style.background = reaction.color;
                
                // Verificar si es la respuesta correcta
                if (mixture === currentChallengeData.target) {
                    // ¬°Correcto!
                    score += 100;
                    updateStats();
                    showMessage('üéâ', '¬°Correcto!', `Has creado ${reaction.result} correctamente. +100 puntos!`, true);
                } else {
                    // Incorrecto
                    lives--;
                    updateStats();
                    
                    if (lives <= 0) {
                        showMessage('üíÄ', 'Game Over', 'Te has quedado sin vidas. El juego ha terminado.', false);
                    } else {
                        showMessage('‚ùå', 'Incorrecto', `Has creado ${reaction.result}, pero necesitas crear ${currentChallengeData.name}. -1 vida!`, false);
                    }
                }
                
                display.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    display.style.transform = 'scale(1)';
                }, 300);
                
            } else {
                // No hay reacci√≥n
                display.innerHTML = '‚ùå';
                display.style.background = '#95a5a6';
                
                lives--;
                updateStats();
                
                if (lives <= 0) {
                    showMessage('üíÄ', 'Game Over', 'Te has quedado sin vidas. El juego ha terminado.', false);
                } else {
                    showMessage('‚ùå', 'Sin Reacci√≥n', 'Estos elementos no reaccionan entre s√≠. -1 vida!', false);
                }
                
                setTimeout(() => {
                    display.innerHTML = 'üí®';
                    display.style.background = '#bdc3c7';
                }, 1500);
            }
            
            display.classList.remove('bubbling');
            
            setTimeout(() => {
                currentMixture = [];
                updateMixtureDisplay();
                
                // Reset used elements
                document.querySelectorAll('.element').forEach(el => {
                    el.classList.remove('used');
                });
            }, 3000);
        }

        function showMessage(icon, title, text, isSuccess) {
            document.getElementById('messageIcon').textContent = icon;
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageText').textContent = text;
            document.getElementById('messageOverlay').style.display = 'flex';
            
            if (isSuccess) {
                document.getElementById('nextBtn').style.display = 'inline-flex';
            }
        }

        function closeMessage() {
            document.getElementById('messageOverlay').style.display = 'none';
            
            if (lives <= 0) {
                resetGame();
            }
        }

        function nextChallenge() {
            currentChallenge++;
            if (currentChallenge >= challenges.length) {
                // Complet√≥ todos los desaf√≠os
                level++;
                currentChallenge = 0;
                score += 500; // Bonus por completar nivel
                showMessage('üèÜ', '¬°Nivel Completado!', `Has completado el nivel ${level-1}! +500 puntos bonus. Ahora el nivel ${level} ser√° m√°s dif√≠cil.`, false);
            }
            
            loadChallenge();
            updateStats();
            clearLab();
            document.getElementById('nextBtn').style.display = 'none';
            closeMessage();
        }

        function resetGame() {
            score = 0;
            lives = 3;
            level = 1;
            currentChallenge = 0;
            loadChallenge();
            updateStats();
            clearLab();
            document.getElementById('nextBtn').style.display = 'none';
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
        }

        function showHint() {
            const challenge = challenges[currentChallenge];
            const elements = challenge.target.split('+');
            const elementNames = elements.map(el => {
                const elementDiv = document.querySelector(`[data-element="${el}"]`);
                return elementDiv ? elementDiv.querySelector('.element-name').textContent : el;
            });
            
            alert(`üí° Pista: Necesitas combinar ${elementNames[0]} + ${elementNames[1]} para crear ${challenge.name}`);
        }

        function clearLab() {
            currentMixture = [];
            updateMixtureDisplay();
            const display = document.getElementById('mixture-display');
            display.classList.remove('bubbling');
            
            // Reset used elements
            document.querySelectorAll('.element').forEach(el => {
                el.classList.remove('used');
            });
        }

        function getElementIcon(element) {
            const icons = {
                water: 'üíß', fire: 'üî•', earth: 'üåç', air: 'üí®', ice: 'üßä', light: '‚òÄÔ∏è',
                oxygen: 'ü´Å', carbon: '‚ö´', metal: 'üî©', salt: 'üßÇ', acid: 'üß™', oil: 'üõ¢Ô∏è',
                seed: 'üå±', electricity: '‚ö°', pressure: 'üí™', cold: 'ü•∂'
            };
            return icons[element] || '‚ùì';
        }

        function getElementColor(element) {
            const colors = {
                water: 'linear-gradient(45deg, #3498db, #2980b9)', fire: 'linear-gradient(45deg, #e74c3c, #c0392b)',
                earth: 'linear-gradient(45deg, #8b4513, #654321)', air: 'linear-gradient(45deg, #ecf0f1, #bdc3c7)',
                ice: 'linear-gradient(45deg, #85c1e9, #5dade2)', light: 'linear-gradient(45deg, #f1c40f, #f39c12)',
                oxygen: 'linear-gradient(45deg, #74b9ff, #0984e3)', carbon: 'linear-gradient(45deg, #2d3436, #636e72)',
                metal: 'linear-gradient(45deg, #95a5a6, #7f8c8d)', salt: 'linear-gradient(45deg, #ffffff, #ecf0f1)',
                acid: 'linear-gradient(45deg, #00b894, #00a085)', oil: 'linear-gradient(45deg, #6c5ce7, #5f3dc4)',
                seed: 'linear-gradient(45deg, #00b894, #00a085)', electricity: 'linear-gradient(45deg, #fdcb6e, #e17055)',
                pressure: 'linear-gradient(45deg, #fd79a8, #e84393)', cold: 'linear-gradient(45deg, #74b9ff, #0984e3)'
            };
            return colors[element] || '#95a5a6';
        }

        // Inicializar el juego cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>